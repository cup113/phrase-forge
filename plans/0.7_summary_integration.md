# 0.7 概要写作批改功能集成计划

## 项目概述

在语匠系统中添加概要写作批改功能，支持标准制定和评分两个阶段。

## 技术架构

- **统一API端点**：`https://dashscope.aliyuncs.com/api/v1/apps/0143013c3ad84d339c9e5ef85c7a99c3/completion`
- **操作类型**：`biz_params.type` 区分标准制定(0)和评分(1)
- **数据流**：query参数承载具体信息

## 三期实施计划

### 第一期：核心基础设施 (Week 1)

#### 目标

建立基础类型定义和API服务层

#### 任务清单

1. **类型定义扩展** (`src/types/index.ts`)
   - 添加类型守卫函数：`isSummaryStandardTask`, `isSummaryEvaluationTask`
   - 修复Task联合类型包含新任务类型
   - 验证类型定义完整性

2. **API配置** (`src/stores/apiConfig.ts`)
   - 添加`summaryEndpoint`字段
   - 更新`getEndpointForTaskType`方法支持'summary'类型

3. **API服务层** (`src/services/apiService.ts`)
   - 实现`evaluateSummaryStandard(passage: string)`
   - 实现`evaluateSummary(passage: string, summary: string, standard: string)`
   - 使用Markdown格式拼接query字符串参数

#### 验收标准

- 类型定义完整且类型安全
- API调用能正确处理两种操作类型
- 向后兼容性保持完好

### 第二期：状态管理和任务处理 (Week 2)

#### 目标

集成到现有任务队列和状态管理系统

#### 任务清单

1. **任务队列扩展** (`src/stores/taskQueue.ts`)
   - 扩展`addTask`支持新任务类型
   - 在`startProcessing`中添加新任务处理逻辑
   - 添加概要写作表单状态管理

2. **历史记录更新** (`src/stores/history.ts`)
   - 更新`taskTypeStats`统计新任务类型

3. **任务项组件** (`src/components/TaskItem.vue`)
   - 添加概要任务的结果展示模板
   - 实现"前往评分"按钮逻辑
   - 实现"重写"按钮逻辑

#### 验收标准

- 新任务类型能正常加入队列和处理
- 历史记录正确统计新任务类型
- 任务项能正确展示结果和操作按钮

### 第三期：用户界面集成 (Week 3)

#### 目标

完成用户界面和交互流程

#### 任务清单

1. **主页集成** (`src/views/HomeView.vue`)
   - 添加"概要写作" tab
   - 集成动态表单组件

2. **表单组件** (新建 `src/components/SummaryInputForm.vue`)
   - 实现类型选择器（标准制定/评分）
   - 动态显示对应字段
   - 表单验证和提交逻辑

3. **交互流程优化**
   - "前往评分"自动填充信息
   - "重写"清空摘要字段
   - 错误处理和用户反馈

#### 验收标准

- 用户能完整完成标准制定→评分流程
- 界面响应式且用户体验良好
- 所有操作按钮功能正常

## 技术要点

### API参数结构

```typescript
// 标准制定 - 仅需原文
{
  biz_params: { type: 0 },
  query: `# 原文\n\n${passage}`
}

// 评分 - 需要原文、学生摘要和评分标准
{
  biz_params: { type: 1 },
  query: `# 原文\n\n${passage}\n\n# 学生摘要\n\n${summary}\n\n# 评分标准\n\n${standard}`
}
```

### 评分维度展示

- 内容分：40分（基本点24 + 附加点16）
- 语言分：10分
- 字数限制：61字，超限每字扣1分

### 向后兼容性

- 现有功能零影响
- 新增字段可选，不破坏现有数据结构
- 错误处理沿用现有机制

## 风险控制

- **技术风险**：低 - 沿用现有架构模式
- **时间风险**：中 - 三期计划预留缓冲时间
- **质量风险**：低 - 每期都有明确验收标准

## 成功指标

- 用户能独立完成概要写作批改全流程
- 系统响应时间与现有功能相当
- 无回归问题影响现有功能
